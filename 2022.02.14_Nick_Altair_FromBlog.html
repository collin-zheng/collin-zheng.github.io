
<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Interactive Plots &amp; Investment Predictions | Nick’s Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Interactive Plots &amp; Investment Predictions" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Projections are usually wrong, lets make some interactive ones together!" />
<meta property="og:description" content="Projections are usually wrong, lets make some interactive ones together!" />
<link rel="canonical" href="https://nglillywhite.github.io/blog_resources/jupyter/viz/finance/2022/01/11/Interactive-Plots-&-FIRE-Predictions.html" />
<meta property="og:url" content="https://nglillywhite.github.io/blog_resources/jupyter/viz/finance/2022/01/11/Interactive-Plots-&-FIRE-Predictions.html" />
<meta property="og:site_name" content="Nick’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-11T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Interactive Plots &amp; Investment Predictions" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-11T00:00:00-06:00","datePublished":"2022-01-11T00:00:00-06:00","description":"Projections are usually wrong, lets make some interactive ones together!","headline":"Interactive Plots &amp; Investment Predictions","mainEntityOfPage":{"@type":"WebPage","@id":"https://nglillywhite.github.io/blog_resources/jupyter/viz/finance/2022/01/11/Interactive-Plots-&-FIRE-Predictions.html"},"url":"https://nglillywhite.github.io/blog_resources/jupyter/viz/finance/2022/01/11/Interactive-Plots-&-FIRE-Predictions.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog_resources/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nglillywhite.github.io/blog_resources/feed.xml" title="Nick's Blog" /><link rel="shortcut icon" type="image/x-icon" href="/blog_resources/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog_resources/">Nick&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog_resources/about/">About Me</a><a class="page-link" href="/blog_resources/search/">Search</a><a class="page-link" href="/blog_resources/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Interactive Plots &amp; Investment Predictions</h1><p class="page-description">Projections are usually wrong, lets make some interactive ones together!</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-11T00:00:00-06:00" itemprop="datePublished">
        Jan 11, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      6 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog_resources/categories/#jupyter">jupyter</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog_resources/categories/#viz">viz</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog_resources/categories/#finance">finance</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/nglillywhite/blog_resources/tree/master/_notebooks/2022-01-11-Interactive Plots & FIRE Predictions.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog_resources/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/nglillywhite/blog_resources/master?filepath=_notebooks%2F2022-01-11-Interactive+Plots+%26+FIRE+Predictions.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog_resources/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/nglillywhite/blog_resources/blob/master/_notebooks/2022-01-11-Interactive Plots & FIRE Predictions.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog_resources/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Fnglillywhite%2Fblog_resources%2Fblob%2Fmaster%2F_notebooks%2F2022-01-11-Interactive+Plots+%26+FIRE+Predictions.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/blog_resources/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Interactive-Charting-Quickie">Interactive Charting Quickie </a></li>
<li class="toc-entry toc-h2"><a href="#Compound-Interest-Calculations">Compound Interest Calculations </a></li>
<li class="toc-entry toc-h2"><a href="#Play-Around">Play Around </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-01-11-Interactive Plots & FIRE Predictions.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I'm a big fan of the value (Graham, Dodd, Bogle) and FIRE investment philosophies. I've been a happy customer of <a href="https://pearler.com/">Pearler</a> and their 'get rich slow' platform. An important set of projections to know is your savings rate and your projected retirement age, there are a few calculators online which all have aspects that I like but often good at one thing not the other. For example,</p>
<ol>
<li>
<a href="https://networthify.com/calculator/earlyretirement">Networthify's Calculator</a> has a nice visualisation and some comparison data as well as some control over some assumptions but you don't see your progression over the years.</li>
<li>
<a href="https://www.playingwithfire.co/retirementcalculator">Playing with Fire</a> has some other great assumptions and a graph over time but not controls over the compounding periods and is missing other assumptions</li>
<li>
<a href="https://www.aussiefirebug.com/australian-financial-independence-calculator/">Aussie Firebug</a> has the most custom / transparent viz but its all excel/gdrive and the viz is limited.</li>
<li>
<a href="https://engaging-data.com/fire-calculator/">Engaging Data</a> has the best in my opinion but is maybe a little busy? Maybe I could replicate this but improve the data-ink ratio (I pray to Tufte, lord of viz)</li>
<li>
<a href="https://walletburst.com/tools/coast-fire-calc/">Wallet Burst</a> has a great UI but I can't see the dark tooltip on hover...</li>
<li>
<a href="https://datadrivenmoney.com/calculate-compound-interest-with-contributions-in-python/">Data Driven Money</a> has some lovely formulas that I need and I like that they've used seaborn and made their plots pretty.</li>
</ol>
<p>I'd like to make my own as all the calculators feel 'close' but not quite what I want, it might be fun to add a 'financial crash' option to see what would happen if in year 't' the bottom fell out of the market, how would it set you back etc. I also thought this might be an interesting exercise to share transparently as well if others are interested in how they might build their own.</p>
<p>I also really like the <a href="https://moneysmart.gov.au/budgeting/compound-interest-calculator">MoneySmart</a> calculator interface, particularly the choice of deposit frequency</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Interactive-Charting-Quickie">
<a class="anchor" href="#Interactive-Charting-Quickie" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interactive Charting Quickie<a class="anchor-link" href="#Interactive-Charting-Quickie"> </a>
</h2>
<p>To start, lets get a dummy interactive chart going so that we get the mechanics of having some interactive widgets that call some function which create our plots.</p>
<p>Lets start with ipywidgets &amp; matplotlib which is easy to begin with, <a href="https://stackoverflow.com/questions/44329068/jupyter-notebook-interactive-plot-with-widgets">stackoverflow strikes again:</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>


<span class="k">def</span> <span class="nf">plot_func</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">freq</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


<span class="n">widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">plot_func</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span>
                                                     <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                     <span class="nb">max</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                                                     <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>

<span class="c1"># Apologies if this doesn't render online on my blog, altair is much happier with fastpages.</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;function __main__.plot_func(freq)&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This gets us started but its not quite the feel I'm looking for, its janky on the re-render. Once again Altair is beautiful and straightforward. Lets use their transform calculate method &amp; selection.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">altair</span> <span class="kn">import</span> <span class="n">datum</span>

<span class="c1"># Lets just grab a range as dummy values</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'x'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1"># This is our range creation</span>
<span class="n">range_binder</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'X Value'</span><span class="p">)</span>

<span class="c1"># This is our selector which we then use to calculate y values &amp; we use our range_binder to set the values of the selctor.</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_single</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"selector"</span><span class="p">,</span>   <span class="c1"># name our object</span>
                                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">'x_mod'</span><span class="p">],</span>  <span class="c1"># name our field</span>
                                <span class="n">bind</span><span class="o">=</span><span class="n">range_binder</span><span class="p">,</span>  <span class="c1"># add in our range_binder</span>
                                <span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">'x_mod'</span><span class="p">:</span> <span class="mf">3.1</span><span class="p">})</span>  <span class="c1"># set an initial value</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">'x:Q'</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">'y:Q'</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"sin(datum.x * selector.x_mod)"</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Interactive Chart!'</span><span class="p">)</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

<div id="altair-viz-500c09ef4e064a48a82caecc19c21527"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-500c09ef4e064a48a82caecc19c21527") {
      outputDiv = document.getElementById("altair-viz-500c09ef4e064a48a82caecc19c21527");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-15841b3b2926b7f5b16247f92d23f1bc"}, "mark": "line", "encoding": {"x": {"field": "x", "type": "quantitative"}, "y": {"field": "y", "type": "quantitative"}}, "selection": {"selector": {"type": "single", "fields": ["x_mod"], "bind": {"input": "range", "max": 5, "min": 0, "name": "X Value", "step": 0.01}, "init": {"x_mod": 3.1}}}, "title": "Interactive Chart!", "transform": [{"calculate": "sin(datum.x * selector.x_mod)", "as": "y"}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json", "datasets": {"data-15841b3b2926b7f5b16247f92d23f1bc": [{"x": 0}, {"x": 1}, {"x": 2}, {"x": 3}, {"x": 4}, {"x": 5}, {"x": 6}, {"x": 7}, {"x": 8}, {"x": 9}, {"x": 10}, {"x": 11}, {"x": 12}, {"x": 13}, {"x": 14}, {"x": 15}, {"x": 16}, {"x": 17}, {"x": 18}, {"x": 19}, {"x": 20}, {"x": 21}, {"x": 22}, {"x": 23}, {"x": 24}, {"x": 25}, {"x": 26}, {"x": 27}, {"x": 28}, {"x": 29}, {"x": 30}, {"x": 31}, {"x": 32}, {"x": 33}, {"x": 34}, {"x": 35}, {"x": 36}, {"x": 37}, {"x": 38}, {"x": 39}, {"x": 40}, {"x": 41}, {"x": 42}, {"x": 43}, {"x": 44}, {"x": 45}, {"x": 46}, {"x": 47}, {"x": 48}, {"x": 49}, {"x": 50}, {"x": 51}, {"x": 52}, {"x": 53}, {"x": 54}, {"x": 55}, {"x": 56}, {"x": 57}, {"x": 58}, {"x": 59}, {"x": 60}, {"x": 61}, {"x": 62}, {"x": 63}, {"x": 64}, {"x": 65}, {"x": 66}, {"x": 67}, {"x": 68}, {"x": 69}, {"x": 70}, {"x": 71}, {"x": 72}, {"x": 73}, {"x": 74}, {"x": 75}, {"x": 76}, {"x": 77}, {"x": 78}, {"x": 79}, {"x": 80}, {"x": 81}, {"x": 82}, {"x": 83}, {"x": 84}, {"x": 85}, {"x": 86}, {"x": 87}, {"x": 88}, {"x": 89}, {"x": 90}, {"x": 91}, {"x": 92}, {"x": 93}, {"x": 94}, {"x": 95}, {"x": 96}, {"x": 97}, {"x": 98}, {"x": 99}]}}, {"mode": "vega-lite"});
</script>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Compound-Interest-Calculations">
<a class="anchor" href="#Compound-Interest-Calculations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compound Interest Calculations<a class="anchor-link" href="#Compound-Interest-Calculations"> </a>
</h2>
<p>Ok now we've got to setup the plots to produce the compound interest, we can then combine the interactivity of the plots above with the compound calculations we do below</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># Compound Interest Formula</span>
<span class="c1"># A = P(1 + r/n)**(nt)</span>

<span class="c1"># Compound Interest with Contributions | Thanks datadrivenmoney, my #6 inspiration</span>
<span class="c1"># A = P(1 + r/n)**nt + M((1 +r/n)^nt -1)/(r/n)</span>

<span class="c1"># Lets setup a starter dataframe with some assumptions locked in and some basic features</span>

<span class="n">years</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">principal</span> <span class="o">=</span> <span class="mi">20000</span>
<span class="n">ror</span> <span class="o">=</span> <span class="mf">0.08</span>
<span class="n">ror_low</span> <span class="o">=</span> <span class="mf">0.06</span>
<span class="n">ror_high</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">periods</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">contributions</span> <span class="o">=</span> <span class="mi">5200</span>

<span class="n">fire_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">"year"</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">years</span><span class="p">),</span>
    <span class="s2">"contributions"</span><span class="p">:</span> <span class="n">contributions</span><span class="o">*</span><span class="n">periods</span><span class="p">})</span>

<span class="n">fire_df</span><span class="p">[</span><span class="s2">"net_cont"</span><span class="p">]</span> <span class="o">=</span> <span class="n">fire_df</span><span class="o">.</span><span class="n">contributions</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

<span class="n">fire_df</span><span class="p">[</span><span class="s2">"net_worth"</span><span class="p">]</span> <span class="o">=</span> <span class="n">principal</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">ror</span><span class="o">/</span><span class="n">periods</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">periods</span><span class="o">*</span><span class="n">fire_df</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">contributions</span><span class="o">*</span><span class="p">(((</span><span class="mi">1</span><span class="o">+</span><span class="n">ror</span><span class="o">/</span><span class="n">periods</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">periods</span><span class="o">*</span><span class="n">fire_df</span><span class="o">.</span><span class="n">year</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ror</span><span class="o">/</span><span class="n">periods</span><span class="p">)</span>

<span class="n">fire_df</span><span class="p">[</span><span class="s2">"low_net_worth"</span><span class="p">]</span> <span class="o">=</span> <span class="n">principal</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">ror_low</span><span class="o">/</span><span class="n">periods</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">periods</span><span class="o">*</span><span class="n">fire_df</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">contributions</span> <span class="o">*</span> \
    <span class="p">(((</span><span class="mi">1</span><span class="o">+</span><span class="n">ror_low</span><span class="o">/</span><span class="n">periods</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">periods</span><span class="o">*</span><span class="n">fire_df</span><span class="o">.</span><span class="n">year</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ror_low</span><span class="o">/</span><span class="n">periods</span><span class="p">)</span>
<span class="n">fire_df</span><span class="p">[</span><span class="s2">"high_net_worth"</span><span class="p">]</span> <span class="o">=</span> <span class="n">principal</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">ror_high</span><span class="o">/</span><span class="n">periods</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">periods</span><span class="o">*</span><span class="n">fire_df</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">contributions</span> <span class="o">*</span> \
    <span class="p">(((</span><span class="mi">1</span><span class="o">+</span><span class="n">ror_high</span><span class="o">/</span><span class="n">periods</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">periods</span><span class="o">*</span><span class="n">fire_df</span><span class="o">.</span><span class="n">year</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ror_high</span><span class="o">/</span><span class="n">periods</span><span class="p">)</span>

<span class="n">fire_df</span><span class="p">[</span><span class="s2">"investment_return"</span><span class="p">]</span> <span class="o">=</span> <span class="n">fire_df</span><span class="o">.</span><span class="n">net_worth</span> <span class="o">-</span> <span class="n">fire_df</span><span class="o">.</span><span class="n">net_cont</span> <span class="o">-</span> <span class="n">principal</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"year:Q"</span><span class="p">)</span>
<span class="n">tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"net_cont"</span><span class="p">,</span> <span class="s2">"net_worth"</span><span class="p">,</span> <span class="s2">"low_net_worth"</span><span class="p">,</span>
           <span class="s2">"high_net_worth"</span><span class="p">,</span> <span class="s2">"year"</span><span class="p">,</span> <span class="s2">"investment_return"</span><span class="p">]</span>


<span class="n">fire_df</span><span class="p">[</span><span class="s2">"noise"</span><span class="p">]</span> <span class="o">=</span> <span class="n">fire_df</span><span class="o">.</span><span class="n">net_worth</span> <span class="o">*</span> \
    <span class="p">[(</span><span class="n">ror</span><span class="o">+</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span><span class="o">/</span><span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">years</span><span class="p">)]</span>

<span class="c1"># Add this plot in if you'd like to see some noise in the full return which might appear more realistic</span>
<span class="c1"># a = alt.Chart(fire_df,).mark_area(opacity=0.3,</span>
<span class="c1">#                                 color="blue").encode(</span>
<span class="c1">#     x=x,</span>
<span class="c1">#     y=alt.Y("noise:Q",title="Noisy Return"),</span>
<span class="c1">#     tooltip=tooltip)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">fire_df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Net Contributions + 8% APR Returns with +2%/-2% Alternate Scenarios"</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                                                                                                              <span class="n">color</span><span class="o">=</span><span class="s2">"darkgreen"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"net_cont:Q"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Contributions"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">fire_df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"net_worth:Q"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Net Worth"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">fire_df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s2">"darkblue"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"low_net_worth:Q"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Low Return"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">)</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">fire_df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"high_net_worth:Q"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"High Return"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">d</span><span class="o">+</span><span class="n">e</span>  <span class="c1"># +a</span>
<span class="n">f</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

<div id="altair-viz-ce6e3d77499a45d8b9b6f6f6f6b3bd2e"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-ce6e3d77499a45d8b9b6f6f6f6b3bd2e") {
      outputDiv = document.getElementById("altair-viz-ce6e3d77499a45d8b9b6f6f6f6b3bd2e");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "color": "darkgreen", "opacity": 0.3}, "encoding": {"tooltip": [{"field": "net_cont", "type": "quantitative"}, {"field": "net_worth", "type": "quantitative"}, {"field": "low_net_worth", "type": "quantitative"}, {"field": "high_net_worth", "type": "quantitative"}, {"field": "year", "type": "quantitative"}, {"field": "investment_return", "type": "quantitative"}], "x": {"field": "year", "type": "quantitative"}, "y": {"field": "net_cont", "title": "Contributions", "type": "quantitative"}}, "title": "Net Contributions + 8% APR Returns with +2%/-2% Alternate Scenarios"}, {"mark": {"type": "area", "color": "blue", "opacity": 0.3}, "encoding": {"tooltip": [{"field": "net_cont", "type": "quantitative"}, {"field": "net_worth", "type": "quantitative"}, {"field": "low_net_worth", "type": "quantitative"}, {"field": "high_net_worth", "type": "quantitative"}, {"field": "year", "type": "quantitative"}, {"field": "investment_return", "type": "quantitative"}], "x": {"field": "year", "type": "quantitative"}, "y": {"field": "net_worth", "title": "Net Worth", "type": "quantitative"}}}, {"mark": {"type": "area", "color": "darkblue", "opacity": 0.3}, "encoding": {"tooltip": [{"field": "net_cont", "type": "quantitative"}, {"field": "net_worth", "type": "quantitative"}, {"field": "low_net_worth", "type": "quantitative"}, {"field": "high_net_worth", "type": "quantitative"}, {"field": "year", "type": "quantitative"}, {"field": "investment_return", "type": "quantitative"}], "x": {"field": "year", "type": "quantitative"}, "y": {"field": "low_net_worth", "title": "Low Return", "type": "quantitative"}}}, {"mark": {"type": "area", "color": "red", "opacity": 0.3}, "encoding": {"tooltip": [{"field": "net_cont", "type": "quantitative"}, {"field": "net_worth", "type": "quantitative"}, {"field": "low_net_worth", "type": "quantitative"}, {"field": "high_net_worth", "type": "quantitative"}, {"field": "year", "type": "quantitative"}, {"field": "investment_return", "type": "quantitative"}], "x": {"field": "year", "type": "quantitative"}, "y": {"field": "high_net_worth", "title": "High Return", "type": "quantitative"}}}], "data": {"name": "data-825fdcfb8894df8d93047c883c673fd0"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json", "datasets": {"data-825fdcfb8894df8d93047c883c673fd0": [{"year": 1, "contributions": 62400, "net_cont": 62400, "net_worth": 86399.60544600782, "low_net_worth": 85378.48057636817, "high_net_worth": 87435.21543219517, "investment_return": 3999.6054460078158, "noise": 82148.74485806422}, {"year": 2, "contributions": 62400, "net_cont": 124800, "net_worth": 158310.34539624766, "low_net_worth": 154789.3627777122, "high_net_worth": 161931.77912586016, "investment_return": 13510.345396247663, "noise": 167935.61439633952}, {"year": 3, "contributions": 62400, "net_cont": 187200, "net_worth": 236189.64129652054, "low_net_worth": 228481.35631281958, "high_net_worth": 244229.10651772487, "investment_return": 28989.641296520538, "noise": 245826.17866141855}, {"year": 4, "contributions": 62400, "net_cont": 249600, "net_worth": 320532.880347032, "low_net_worth": 306718.5107611053, "high_net_worth": 335144.03950301226, "investment_return": 50932.88034703198, "noise": 298352.0050270174}, {"year": 5, "contributions": 62400, "net_cont": 312000, "net_worth": 411876.566641284, "low_net_worth": 389781.16170226596, "high_net_worth": 435578.95399740903, "investment_return": 79876.56664128398, "noise": 412206.06789459696}, {"year": 6, "contributions": 62400, "net_cont": 374400, "net_worth": 510801.73384793877, "low_net_worth": 477966.93520114204, "high_net_worth": 546530.7164667185, "investment_return": 116401.73384793877, "noise": 495886.32321957895}, {"year": 7, "contributions": 62400, "net_cont": 436800, "net_worth": 617937.6411435963, "low_net_worth": 571591.8142470069, "high_net_worth": 669100.5783222077, "investment_return": 161137.64114359627, "noise": 618431.9912565111}, {"year": 8, "contributions": 62400, "net_cont": 499200, "net_worth": 733965.7759061685, "low_net_worth": 670991.2709684992, "high_net_worth": 804505.1063884409, "investment_return": 214765.7759061685, "noise": 727213.2907678317}, {"year": 9, "contributions": 62400, "net_cont": 561600, "net_worth": 859624.1886298294, "low_net_worth": 776521.468681093, "high_net_worth": 954088.2579339307, "investment_return": 278024.18862982944, "noise": 825926.9204355401}, {"year": 10, "contributions": 62400, "net_cont": 624000, "net_worth": 995712.1876357687, "low_net_worth": 888560.5380742274, "high_net_worth": 1119334.720115285, "investment_return": 351712.18763576867, "noise": 1076165.7323967388}, {"year": 11, "contributions": 62400, "net_cont": 686400, "net_worth": 1143095.423441622, "low_net_worth": 1007509.932110865, "high_net_worth": 1301884.646235471, "investment_return": 436695.42344162194, "noise": 1075424.174373878}, {"year": 12, "contributions": 62400, "net_cont": 748800, "net_worth": 1302711.3951310555, "low_net_worth": 1133795.8644942902, "high_net_worth": 1503549.935080884, "investment_return": 533911.3951310555, "noise": 1368889.134003713}, {"year": 13, "contributions": 62400, "net_cont": 811200, "net_worth": 1475575.4137493141, "low_net_worth": 1267870.8368563938, "high_net_worth": 1726332.2149177354, "investment_return": 644375.4137493141, "noise": 1565290.3989052724}, {"year": 14, "contributions": 62400, "net_cont": 873600, "net_worth": 1662787.0606576526, "low_net_worth": 1410215.260139584, "high_net_worth": 1972442.7106478687, "investment_return": 769187.0606576526, "noise": 1680745.1609127552}, {"year": 15, "contributions": 62400, "net_cont": 936000, "net_worth": 1865537.1819280041, "low_net_worth": 1561339.1759819963, "high_net_worth": 2244324.1913154027, "investment_return": 909537.1819280041, "noise": 1997617.2144085069}, {"year": 16, "contributions": 62400, "net_cont": 998400, "net_worth": 2085115.4632689583, "low_net_worth": 1721784.084273963, "high_net_worth": 2544675.215804116, "investment_return": 1066715.4632689583, "noise": 2191039.3288030215}, {"year": 17, "contributions": 62400, "net_cont": 1060800, "net_worth": 2322918.633666852, "low_net_worth": 1892124.8834341774, "high_net_worth": 2876476.917376178, "investment_return": 1242118.633666852, "noise": 2557068.8319404707}, {"year": 18, "contributions": 62400, "net_cont": 1123200, "net_worth": 2580459.3499250324, "low_net_worth": 2072971.9303578443, "high_net_worth": 3243022.5929020923, "investment_return": 1437259.3499250324, "noise": 2401891.56291022}, {"year": 19, "contributions": 62400, "net_cont": 1185600, "net_worth": 2859375.818615496, "low_net_worth": 2264973.2274179193, "high_net_worth": 3647950.390469668, "investment_return": 1653775.8186154962, "noise": 3004632.110201163}]}}, {"mode": "vega-lite"});
</script>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok this is exciting, we've got various returns and our net contributions all outlined and shown on our viz, lets add in the interactivity we had on the first vizualisation and we should have a nice FIRE graph to play around with</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'x'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>
<span class="p">})</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># This is our range creation</span>
<span class="n">range_binder</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Rate of Return'</span><span class="p">)</span>

<span class="c1"># This is our selector which we then use to calculate y values &amp; we use our range_binder to set the values of the selctor.</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_single</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"selector"</span><span class="p">,</span>   <span class="c1"># name our object</span>
                                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">'x_mod'</span><span class="p">],</span>  <span class="c1"># name our field</span>
                                <span class="n">bind</span><span class="o">=</span><span class="n">range_binder</span><span class="p">,</span>  <span class="c1"># add in our range_binder</span>
                                <span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">'x_mod'</span><span class="p">:</span> <span class="mf">0.06</span><span class="p">})</span>  <span class="c1"># set an initial value</span>

<span class="c1"># RoR 2 selector</span>
<span class="n">range_binder2</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Rate of Return 2'</span><span class="p">)</span>
<span class="n">selector2</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_single</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"selector2"</span><span class="p">,</span>
                                 <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">'x_mod'</span><span class="p">],</span>
                                 <span class="n">bind</span><span class="o">=</span><span class="n">range_binder2</span><span class="p">,</span>
                                 <span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">'x_mod'</span><span class="p">:</span> <span class="mf">0.08</span><span class="p">})</span>

<span class="c1"># Principal selector</span>
<span class="n">p_range_binder</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">500000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Principal'</span><span class="p">)</span>
<span class="n">p_selector</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_single</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"p_selector"</span><span class="p">,</span>
                                  <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">'principal'</span><span class="p">],</span>
                                  <span class="n">bind</span><span class="o">=</span><span class="n">p_range_binder</span><span class="p">,</span>
                                  <span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">'principal'</span><span class="p">:</span> <span class="mi">10000</span><span class="p">})</span>

<span class="c1"># Monthly Contribution Selector</span>
<span class="n">contrib_binder</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Monthly Contributions'</span><span class="p">)</span>
<span class="n">contrib_selector</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_single</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"contrib_selector"</span><span class="p">,</span>
                                        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">'contrib'</span><span class="p">],</span>
                                        <span class="n">bind</span><span class="o">=</span><span class="n">contrib_binder</span><span class="p">,</span>
                                        <span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">'contrib'</span><span class="p">:</span> <span class="mi">1000</span><span class="p">})</span>


<span class="c1"># We've gotta do some string mangling to stuff our variables into the vega expression required for the calculate transform but its not too deadly</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"x:Q"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Years"</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"y:Q"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"$ Investment Value"</span><span class="p">)</span>

<span class="c1"># Lets just do 20 years</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s2">"darkblue"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"p_selector.principal*pow((1+(selector.x_mod/12)), 12*datum.x) + contrib_selector.contrib*(pow((1+selector.x_mod/12),12*datum.x)-1)/(selector.x_mod/12)"</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Interactive Rates of Return'</span><span class="p">)</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span>
    <span class="n">selector</span><span class="p">)</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">p_selector</span><span class="p">)</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">contrib_selector</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"p_selector.principal*pow((1+(selector2.x_mod/12)), 12*datum.x) + contrib_selector.contrib*(pow((1+selector2.x_mod/12),12*datum.x)-1)/(selector2.x_mod/12)"</span><span class="p">)</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">selector2</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"darkblue"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"contrib_selector.contrib*12*datum.x"</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">b</span><span class="o">+</span><span class="n">a</span><span class="o">+</span><span class="n">c</span>
<span class="n">d</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

<div id="altair-viz-2de672d46fc944e2bc1101847e52d901"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-2de672d46fc944e2bc1101847e52d901") {
      outputDiv = document.getElementById("altair-viz-2de672d46fc944e2bc1101847e52d901");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "color": "blue", "opacity": 0.3}, "encoding": {"tooltip": [{"field": "x", "title": "Years", "type": "quantitative"}, {"field": "y", "title": "$ Investment Value", "type": "quantitative"}], "x": {"field": "x", "title": "Years", "type": "quantitative"}, "y": {"field": "y", "title": "$ Investment Value", "type": "quantitative"}}, "selection": {"selector2": {"type": "single", "fields": ["x_mod"], "bind": {"input": "range", "max": 0.15, "min": 0, "name": "Rate of Return 2", "step": 0.01}, "init": {"x_mod": 0.08}}}, "transform": [{"calculate": "p_selector.principal*pow((1+(selector2.x_mod/12)), 12*datum.x) + contrib_selector.contrib*(pow((1+selector2.x_mod/12),12*datum.x)-1)/(selector2.x_mod/12)", "as": "y"}]}, {"mark": {"type": "area", "color": "darkblue", "opacity": 0.3}, "encoding": {"tooltip": [{"field": "x", "title": "Years", "type": "quantitative"}, {"field": "y", "title": "$ Investment Value", "type": "quantitative"}], "x": {"field": "x", "title": "Years", "type": "quantitative"}, "y": {"field": "y", "title": "$ Investment Value", "type": "quantitative"}}, "selection": {"selector": {"type": "single", "fields": ["x_mod"], "bind": {"input": "range", "max": 0.15, "min": 0, "name": "Rate of Return", "step": 0.01}, "init": {"x_mod": 0.06}}, "p_selector": {"type": "single", "fields": ["principal"], "bind": {"input": "range", "max": 500000, "min": 0, "name": "Principal", "step": 10000}, "init": {"principal": 10000}}, "contrib_selector": {"type": "single", "fields": ["contrib"], "bind": {"input": "range", "max": 8000, "min": 0, "name": "Monthly Contributions", "step": 100}, "init": {"contrib": 1000}}}, "title": "Interactive Rates of Return", "transform": [{"calculate": "p_selector.principal*pow((1+(selector.x_mod/12)), 12*datum.x) + contrib_selector.contrib*(pow((1+selector.x_mod/12),12*datum.x)-1)/(selector.x_mod/12)", "as": "y"}]}, {"mark": {"type": "area", "color": "darkblue", "opacity": 0.3}, "encoding": {"tooltip": [{"field": "x", "title": "Years", "type": "quantitative"}, {"field": "y", "title": "$ Investment Value", "type": "quantitative"}], "x": {"field": "x", "title": "Years", "type": "quantitative"}, "y": {"field": "y", "title": "$ Investment Value", "type": "quantitative"}}, "transform": [{"calculate": "contrib_selector.contrib*12*datum.x", "as": "y"}]}], "data": {"name": "data-389d86acea5c8765e4f108c759d0e401"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json", "datasets": {"data-389d86acea5c8765e4f108c759d0e401": [{"x": 1}, {"x": 2}, {"x": 3}, {"x": 4}, {"x": 5}, {"x": 6}, {"x": 7}, {"x": 8}, {"x": 9}, {"x": 10}, {"x": 11}, {"x": 12}, {"x": 13}, {"x": 14}, {"x": 15}, {"x": 16}, {"x": 17}, {"x": 18}, {"x": 19}, {"x": 20}, {"x": 21}, {"x": 22}, {"x": 23}, {"x": 24}, {"x": 25}, {"x": 26}, {"x": 27}, {"x": 28}, {"x": 29}, {"x": 30}, {"x": 31}, {"x": 32}, {"x": 33}, {"x": 34}, {"x": 35}, {"x": 36}, {"x": 37}, {"x": 38}, {"x": 39}]}}, {"mode": "vega-lite"});
</script>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Play-Around">
<a class="anchor" href="#Play-Around" aria-hidden="true"><span class="octicon octicon-link"></span></a>Play Around<a class="anchor-link" href="#Play-Around"> </a>
</h2>
<p>Ok so we've now got a nice plot of our investments over time that we can adjust multiple rates of return, principal starting value and the contributions.</p>
<p>Playing around with the values, you can see that monthly contributions and return rate are by far the biggest factors. People overemphasize getting a big initial investment when wanting to invest their money but actually their rate of return and ability to continue to contribute is what matters most. Going from no monthly contributions to just \$100 changes your initial $10000 value at 40 years to over \$500,000 from \\$220,000 despite only contributing an extra \$44,000.</p>
<p>Obviously this isn't investment advice, we're playing around with plots on a computer screen but the power of compounding is in your fingertips to play with and I think its fantastic. The more I use Altair, the more I like it. I'm sure I could refactor my code to improve the restating of the baseplot etc but I'll do that at a later date, this should suffice in showing you how to integrate interactivity and inputs into your plots live.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="nglillywhite/blog_resources"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog_resources/jupyter/viz/finance/2022/01/11/Interactive-Plots-&-FIRE-Predictions.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog_resources/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog_resources/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog_resources/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>My thoughts and posts using fastai&#39;s fantastic fastpages.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/nglillywhite" target="_blank" title="nglillywhite"><svg class="svg-icon grey"><use xlink:href="/blog_resources/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
